<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FreshStop — Better routes for cleaner air</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='28' fill='%230ea5e9'/%3E%3Ctext x='32' y='40' font-size='28' text-anchor='middle' fill='white'%3FF%3C/text%3E%3C/svg%3E">

  <!-- Leaflet (map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <style>
    :root{
      --bg:#0b0c10; --fg:#fff; --line:#e5e7eb; --muted:#6b7280; --brand:#0ea5e9;
      --bus:#0ea5e9; --train:#10b981; --dest:#ef4444;
      --good:#16a34a; --fair:#84cc16; --moderate:#eab308; --poor:#f97316; --vpoor:#ef4444;
      --card-bg:#fff; --chip-bg:#f1f5f9;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:#111;background:#fafafa}
    header{display:flex;gap:12px;align-items:center;padding:10px 12px;background:var(--bg);color:var(--fg)}
    header .title{font-weight:700}
    header .tag{font-size:12px;color:#c7d2fe;opacity:.9}
    .container{display:grid;grid-template-rows:auto 1fr auto;height:100vh}
    .main{display:grid;grid-template-columns:1.7fr 1fr;min-height:0}
    @media (max-width:900px){.main{grid-template-columns:1fr}}
    #map{height:calc(100vh - 170px);width:100%}
    @media (max-width:900px){#map{height:50vh}}
    aside{border-left:1px solid var(--line);padding:12px;min-height:0;overflow:auto;background:#fcfcfd}
    @media (max-width:900px){aside{border-left:none;border-top:1px solid var(--line)}}
    .row{display:flex;gap:8px;align-items:center}
    .search{position:relative;width:60%;max-width:320px;margin-left:auto}
    .search input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--line);outline:none}
    .dropdown{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid var(--line);border-radius:10px;margin-top:6px;overflow:hidden;z-index:1000;box-shadow:0 6px 24px rgba(0,0,0,.08)}
    .dropdown button{display:block;width:100%;text-align:left;padding:10px 12px;border:0;background:#fff;cursor:pointer}
    .dropdown button:hover{background:#f9fafb}
    .card{border:1px solid var(--line);border-radius:16px;padding:12px;background:var(--card-bg);box-shadow:0 10px 22px rgba(0,0,0,.04)}
    .muted{color:var(--muted);font-size:14px}
    .error{color:#b91c1c}
    .pill{display:inline-block;padding:3px 8px;border-radius:999px;background:var(--chip-bg);font-size:12px}
    .pilla{display:inline-block;padding:3px 8px;border-radius:999px;font-size:16px}
    .btn{border:1px solid var(--line);border-radius:10px;padding:8px 10px;background:#fff;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    footer{border-top:1px solid var(--line);padding:10px 12px;font-size:12px;color:var(--muted)}
    .stack{display:grid;gap:12px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    @media (max-width:420px){.grid2{grid-template-columns:1fr}}
    .kv{display:flex;justify-content:space-between;gap:10px;font-size:14px}
    .list{display:grid;gap:8px}
    .stop-item{display:flex;justify-content:space-between;gap:10px;align-items:center;padding:8px;border-radius:12px;background:#fff;border:1px solid #eef2f7}
    .stop-left{display:flex;gap:10px;align-items:center}
    .stop-name{font-weight:600}
    .stop-kind{font-size:12px;padding:2px 6px;border-radius:999px}
    .kind-bus{background:rgba(14,165,233,.12);color:#0369a1}
    .kind-train{background:rgba(16,185,129,.14);color:#065f46}
    .stop-wx{display:flex;gap:6px;align-items:center;font-size:13px;color:#111}
    .stop-wx img{width:22px;height:22px;image-rendering:-webkit-optimize-contrast}

    /* Weather card */
    .wx-card{background:linear-gradient(135deg,#0ea5e933,#22c55e22);border:1px solid #0ea5e94d;border-radius:14px;padding:12px;box-shadow:0 6px 20px rgba(14,165,233,.15)}
    .wx-main{display:flex;gap:12px;align-items:center}
    .wx-temp{font-size:34px;font-weight:800;line-height:1}
    .wx-desc{margin-top:2px;font-weight:600}
    .wx-hours{display:flex;gap:10px;margin-top:8px}
    .wx-hour{background:#ffffffaa;border:1px solid #e5e7eb;border-radius:10px;padding:6px 8px;text-align:center;min-width:78px;backdrop-filter:blur(2px);box-shadow:0 3px 10px rgba(0,0,0,.05)}
    .wx-hour img{width:40px;height:40px;display:block;margin:2px auto}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">FreshStop</div>
      <div class="tag">Better routes for cleaner air</div>

      <!-- Search current place -->
      <div class="search">
        <input id="search" type="text" placeholder="Search a place or postcode…" />
        <div id="results" class="dropdown" style="display:none;"></div>
      </div>

      <!-- Home (one-time) -->
      <div class="search" style="max-width:360px;margin-left:12px;">
        <input id="home-input" type="text" placeholder="Set Home (address or postcode)…" />
        <div id="home-results" class="dropdown" style="display:none;"></div>
      </div>
      <span id="home-pill" class="pilla" style="display:none;margin-left:8px;"></span>
      <button id="home-edit" class="btn" style="display:none;">Change</button>
    </header>

    <div class="main">
      <div>
        <div id="map"></div>

        <!-- Primary actions -->
        <div style="padding:12px;border-top:1px solid var(--line);display:flex;gap:8px;flex-wrap:wrap;align-items:center;background:#fff;">
          <button id="btn-my-location" class="btn">Use my location</button>

          <!-- Single, simple CTA -->
          <button id="btn-best-home" class="btn primary" title="Find the nearest stop that will get me home">Best stop to get home</button>

          <!-- Optional small hint -->
          <span class="muted" style="margin-left:auto;">Set your Home, then tap “Best stop to get home”.</span>
        </div>
      </div>

      <aside>
        <div class="stack">
          <div id="selection" class="card" style="display:none;"></div>
          <div id="weather" class="card" style="display:none;"></div>
          <div id="air" class="card" style="display:none;"></div>

          <!-- Nearby stops (renamed visually, same IDs so JS can keep working) -->
          <div id="stops" class="card" style="display:none;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
              <div style="font-weight:600;">Best stop to get home</div>
              <div class="muted" style="font-size:12px;">Radius: <span id="stops-radius">800</span> m</div>
            </div>
            <div id="stops-list" class="list"></div>
          </div>

          <div id="directions" class="card" style="display:none;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="font-weight:600;">Directions</div>
              <button id="btn-clear-route" class="btn">Clear</button>
            </div>
            <div id="directions-steps" class="list" style="margin-top:8px;"></div>
          </div>

          <div id="errors" class="error" style="display:none;"></div>
        </div>
      </aside>
    </div>

    <footer>
      Map © OpenStreetMap • Stops: OSM Overpass • Routing: OSRM (fallback ORS) • Weather &amp; Air: OpenWeatherMap
    </footer>
  </div>

  <!-- Keys (DO NOT COMMIT) -->
  <script src="config.js"></script>
  <!-- App code -->
  <script src="app.js"></script>
</body>
</html>
