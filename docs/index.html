<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FreshStop — Better routes for cleaner air</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='28' fill='%230ea5e9'/%3E%3Ctext x='32' y='40' font-size='28' text-anchor='middle' fill='white'%3FF%3C/text%3E%3C/svg%3E">

  <!-- Leaflet (map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <style>
    /* your existing CSS … */
    /* (leaving all your styles exactly as-is) */

    /* Loader styles (already in your CSS, keeping for clarity) */
    #fs-loader {
      position: fixed; inset: 0;
      display: none;
      align-items: center; justify-content: center;
      background: rgba(255,255,255,.72);
      z-index: 9999;
      backdrop-filter: blur(2px);
    }
    .fs-loader-card {
      background: white; border: 1px solid #e5e7eb; border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      padding: 14px 16px; text-align: center; width: 320px;
    }
    .fs-loader-text { color:#374151; font-size:14px; margin-top:6px; }
    .fs-loader-svg { display: block; margin: 0 auto; }
    @keyframes slide { 0%{transform:translateX(-20px)} 100%{transform:translateX(250px)} }
    .fs-vehicle { animation: slide 2.6s cubic-bezier(.4,.0,.2,1) infinite; }
    @keyframes busShow { 0%,49%{opacity:1} 50%,100%{opacity:0} }
    @keyframes trainShow { 0%,49%{opacity:0} 50%,100%{opacity:1} }
    .bus { animation: busShow 2.6s linear infinite; }
    .train { animation: trainShow 2.6s linear infinite; }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="title">FreshStop</div>
      <div class="tag">Better routes for cleaner air</div>

      <!-- Home setup/display -->
      <div class="search" style="max-width: 360px; margin-left:12px;">
        <input id="home-input" type="text" placeholder="Set Home (address or postcode)…" />
        <div id="home-results" class="dropdown" style="display:none;"></div>
      </div>
      <span id="home-pill" class="pilla" style="display:none; margin-left:8px; cursor:pointer;" title="Click to change Home"></span>
    </header>

    <div class="main">
      <div>
        <div id="map"></div>
        <div style="padding:12px; border-top:1px solid var(--line); display:flex; gap:8px; flex-wrap: wrap; align-items:center; background:#fff;">
          <button id="btn-my-location" class="btn">Use my location</button>
          <button id="btn-best-stop" class="btn primary" title="Find best stop towards Home">Best stop to get home?</button>
          <span id="best-label" class="pill" style="display:none;">Best stop is pulsing on the map</span>
          <span class="muted" style="margin-left:auto;">Tap the map or use search to pick a spot. Set Home to enable “best stop”.</span>
        </div>
      </div>

      <aside>
        <div class="stack">
          <div id="selection" class="card" style="display:none;"></div>

          <div id="stops" class="card" style="display:none;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
              <div style="font-weight:600;">Nearby stops</div>
              <div class="muted" style="font-size:12px;">Radius: <span id="stops-radius">800</span> m</div>
            </div>
            <div id="stops-list" class="list"></div>
          </div>

          <div id="directions" class="card" style="display:none;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <div style="font-weight:600;">Directions</div>
              <button id="btn-clear-route" class="btn">Clear</button>
            </div>
            <div id="directions-steps" class="list" style="margin-top:8px;"></div>
          </div>

          <div id="errors" class="error" style="display:none;"></div>
        </div>
      </aside>
    </div>

    <footer>
      Map © OpenStreetMap • Stops: OSM Overpass (+ TfL when available) • Routing: OSRM • Air: Open-Meteo • Weather (inline, if enabled): Met Office DataHub • NaPTAN (optional static) • BODS (optional SIRI-VM)
    </footer>
  </div>

  <!-- Keys (DO NOT COMMIT) -->
  <script src="config.js"></script>
  <!-- App code -->
  <script src="app.js"></script>

  <!-- Full-screen loader (✅ moved into the body, just before </body>) -->
  <div id="fs-loader" aria-hidden="true" style="display:none;">
    <div class="fs-loader-card">
      <svg viewBox="0 0 300 80" width="280" height="74" class="fs-loader-svg">
        <rect x="0" y="52" width="300" height="4" rx="2" fill="#e5e7eb"/>
        <g class="fs-vehicle">
          <g class="bus">
            <rect x="0" y="22" width="54" height="28" rx="6" fill="#0ea5e9"/>
            <rect x="6" y="28" width="16" height="10" rx="2" fill="white" opacity="0.9"/>
            <rect x="26" y="28" width="10" height="10" rx="2" fill="white" opacity="0.9"/>
            <rect x="40" y="28" width="10" height="10" rx="2" fill="white" opacity="0.9"/>
            <circle cx="14" cy="54" r="5" fill="#111"/>
            <circle cx="40" cy="54" r="5" fill="#111"/>
          </g>
          <g class="train">
            <rect x="0" y="18" width="70" height="30" rx="6" fill="#10b981"/>
            <rect x="8" y="24" width="14" height="10" rx="2" fill="white" opacity="0.9"/>
            <rect x="26" y="24" width="14" height="10" rx="2" fill="white" opacity="0.9"/>
            <rect x="44" y="24" width="14" height="10" rx="2" fill="white" opacity="0.9"/>
            <circle cx="18" cy="54" r="4.5" fill="#111"/>
            <circle cx="52" cy="54" r="4.5" fill="#111"/>
          </g>
        </g>
      </svg>
      <div class="fs-loader-text">Finding the best route…</div>
    </div>
  </div>
</body>
</html>
